<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyTracker - Gest√£o Financeira</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(0, 255, 127, 0.1);
            border-radius: 15px;
            border: 1px solid #00ff7f;
            box-shadow: 0 0 20px rgba(0, 255, 127, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            color: #00ff7f;
            text-shadow: 0 0 10px rgba(0, 255, 127, 0.5);
            margin-bottom: 10px;
        }

        .balance-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .balance-card h3 {
            color: #00ff7f;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .balance-amount {
            font-size: 1.8em;
            font-weight: bold;
        }

        .balance-amount.positive {
            color: #00ff7f;
        }

        .balance-amount.negative {
            color: #ff4757;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 5px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            flex-wrap: wrap;
        }

        .tab {
            flex: 1;
            padding: 15px 25px;
            background: transparent;
            border: none;
            color: #ffffff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1em;
            min-width: 150px;
        }

        .tab.active {
            background: #00ff7f;
            color: #000000;
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.5);
        }

        .tab:hover:not(.active) {
            background: rgba(0, 255, 127, 0.2);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #00ff7f;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00ff7f;
            box-shadow: 0 0 10px rgba(0, 255, 127, 0.3);
        }

        .installment-info {
            background: rgba(255, 165, 0, 0.1);
            border: 1px solid rgba(255, 165, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            color: #ffa500;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: #00ff7f;
            color: #000000;
        }

        .btn-primary:hover {
            background: #00cc66;
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.5);
        }

        .btn-danger {
            background: #ff4757;
            color: #ffffff;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(0, 255, 127, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(0, 255, 127, 0.2);
            border-color: #00ff7f;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 0.8em;
        }

        .view-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: rgba(0, 255, 127, 0.2);
            border-color: #00ff7f;
        }

        .transactions-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            overflow: hidden;
        }

        .transaction-item {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr auto auto;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
            transition: background 0.3s ease;
        }

        .transaction-item:hover {
            background: rgba(0, 255, 127, 0.1);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-date {
            color: #cccccc;
            font-size: 0.9em;
        }

        .transaction-description {
            font-weight: 500;
        }

        .transaction-category {
            color: #00ff7f;
            font-size: 0.9em;
        }

        .transaction-amount {
            font-weight: bold;
            text-align: right;
        }

        .transaction-amount.income {
            color: #00ff7f;
        }

        .transaction-amount.expense {
            color: #ff4757;
        }

        .installment-badge {
            background: rgba(255, 165, 0, 0.2);
            color: #ffa500;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            border: 1px solid rgba(255, 165, 0, 0.3);
        }

        .salary-item {
            background: rgba(0, 255, 127, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: center;
        }

        .salary-info {
            display: flex;
            flex-direction: column;
        }

        .salary-amount {
            font-size: 1.2em;
            font-weight: bold;
            color: #00ff7f;
        }

        .benefit-item {
            background: rgba(0, 150, 255, 0.1);
            border: 1px solid rgba(0, 150, 255, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 10px;
            display: grid;
            grid-template-columns: 1fr auto auto;
            gap: 15px;
            align-items: center;
        }

        .benefit-info {
            display: flex;
            flex-direction: column;
        }

        .benefit-amount {
            font-size: 1.2em;
            font-weight: bold;
            color: #0096ff;
        }

        .benefit-description {
            color: #cccccc;
            font-size: 0.9em;
        }

        .benefit-details {
            color: #0096ff;
            font-size: 0.8em;
            margin-top: 5px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            padding: 20px;
            height: 400px;
            position: relative;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
        }

        .summary-card h4 {
            color: #00ff7f;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .filter-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-container input, .filter-container select {
            padding: 8px 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
        }

        .projection-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            padding: 20px;
            margin-bottom: 20px;
        }

        .projection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .projection-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .projection-period {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 6px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .projection-period.active {
            background: rgba(0, 255, 127, 0.2);
            border-color: #00ff7f;
        }

        .projection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .projection-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            text-align: center;
        }

        .projection-card h5 {
            color: #00ff7f;
            margin-bottom: 10px;
            font-size: 0.9em;
        }

        .projection-value {
            font-size: 1.4em;
            font-weight: bold;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(26, 26, 26, 0.95);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            max-width: 500px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .close-btn {
            background: none;
            border: none;
            color: #ffffff;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: #ff4757;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #cccccc;
        }

        .empty-state i {
            font-size: 3em;
            color: #00ff7f;
            margin-bottom: 20px;
        }

        .list-container {
            max-height: 300px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .transaction-item {
                grid-template-columns: 1fr;
                gap: 8px;
                text-align: left;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .view-controls {
                justify-content: stretch;
            }

            .view-btn {
                flex: 1;
                text-align: center;
            }

            .projection-header {
                flex-direction: column;
                gap: 15px;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
            }
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 127, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 127, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>MoneyTracker</h1>
            <p>Gerencie suas finan√ßas de forma inteligente</p>
        </header>

        <div class="balance-display">
            <div class="balance-card">
                <h3>Receitas Totais</h3>
                <div class="balance-amount positive" id="totalIncome">R$ 0,00</div>
            </div>
            <div class="balance-card">
                <h3>Gastos Totais</h3>
                <div class="balance-amount negative" id="totalExpenses">R$ 0,00</div>
            </div>
            <div class="balance-card">
                <h3>Saldo Atual</h3>
                <div class="balance-amount" id="currentBalance">R$ 0,00</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('income')">Adicionar Receita</button>
            <button class="tab" onclick="showSection('expense')">Adicionar Gasto</button>
            <button class="tab" onclick="showSection('salaries')">Sal√°rios</button>
            <button class="tab" onclick="showSection('benefits')">Benef√≠cios</button>
            <button class="tab" onclick="showSection('projections')">Proje√ß√µes</button>
            <button class="tab" onclick="showSection('dashboard')">Dashboard</button>
        </div>

        <!-- Se√ß√£o Adicionar Receita -->
        <div id="income-section" class="content-section active">
            <div class="form-container">
                <h2 style="color: #00ff7f; margin-bottom: 20px;">Adicionar Receita</h2>
                <form id="incomeForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="incomeDescription">Descri√ß√£o</label>
                            <input type="text" id="incomeDescription" placeholder="Ex: Sal√°rio, Freelance..." required>
                        </div>
                        <div class="form-group">
                            <label for="incomeAmount">Valor (R$)</label>
                            <input type="number" id="incomeAmount" step="0.01" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeDate">Data de Recebimento</label>
                            <input type="date" id="incomeDate" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeCategory">Categoria</label>
                            <select id="incomeCategory" required>
                                <option value="">Selecione...</option>
                                <option value="Sal√°rio">Sal√°rio</option>
                                <option value="Freelance">Freelance</option>
                                <option value="Investimentos">Investimentos</option>
                                <option value="Vendas">Vendas</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Receita</button>
                </form>
            </div>
        </div>

        <!-- Se√ß√£o Adicionar Gasto -->
        <div id="expense-section" class="content-section">
            <div class="form-container">
                <h2 style="color: #ff4757; margin-bottom: 20px;">Adicionar Gasto</h2>
                <form id="expenseForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="expenseDescription">Descri√ß√£o</label>
                            <input type="text" id="expenseDescription" placeholder="Ex: Supermercado, Gasolina..." required>
                        </div>
                        <div class="form-group">
                            <label for="expenseAmount">Valor (R$)</label>
                            <input type="number" id="expenseAmount" step="0.01" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label for="expenseDate">Data de Pagamento</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                        <div class="form-group">
                            <label for="expenseCategory">Categoria</label>
                            <select id="expenseCategory" required>
                                <option value="">Selecione...</option>
                                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                <option value="Transporte">Transporte</option>
                                <option value="Moradia">Moradia</option>
                                <option value="Sa√∫de">Sa√∫de</option>
                                <option value="Educa√ß√£o">Educa√ß√£o</option>
                                <option value="Lazer">Lazer</option>
                                <option value="Vestu√°rio">Vestu√°rio</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="installments">Parcelas (opcional)</label>
                            <select id="installments">
                                <option value="1">√Ä vista</option>
                                <option value="2">2x</option>
                                <option value="3">3x</option>
                                <option value="4">4x</option>
                                <option value="5">5x</option>
                                <option value="6">6x</option>
                                <option value="7">7x</option>
                                <option value="8">8x</option>
                                <option value="9">9x</option>
                                <option value="10">10x</option>
                                <option value="11">11x</option>
                                <option value="12">12x</option>
                            </select>
                        </div>
                    </div>
                    <div id="installmentInfo" class="installment-info" style="display: none;">
                        <p>Valor por parcela: <span id="installmentAmount">R$ 0,00</span></p>
                        <p>Primeira parcela: <span id="firstInstallment"></span></p>
                        <p>√öltima parcela: <span id="lastInstallment"></span></p>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Gasto</button>
                </form>
            </div>
        </div>

        <!-- Se√ß√£o Sal√°rios -->
        <div id="salaries-section" class="content-section">
            <div class="form-container">
                <h2 style="color: #00ff7f; margin-bottom: 20px;">Gerenciar Sal√°rios Mensais</h2>
                <form id="salaryForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="salaryDescription">Descri√ß√£o</label>
                            <input type="text" id="salaryDescription" placeholder="Ex: Sal√°rio CLT, Freelance Mensal..." required>
                        </div>
                        <div class="form-group">
                            <label for="salaryAmount">Valor Mensal (R$)</label>
                            <input type="number" id="salaryAmount" step="0.01" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label for="salaryDay">Dia do Pagamento</label>
                            <select id="salaryDay" required>
                                <option value="">Selecione...</option>
                                <option value="5">Dia 5</option>
                                <option value="10">Dia 10</option>
                                <option value="15">Dia 15</option>
                                <option value="20">Dia 20</option>
                                <option value="25">Dia 25</option>
                                <option value="30">√öltimo dia do m√™s</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Sal√°rio</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="color: #00ff7f; margin-bottom: 15px;">Sal√°rios Cadastrados</h3>
                    <div id="salariesList"></div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o Benef√≠cios -->
        <div id="benefits-section" class="content-section">
            <div class="form-container">
                <h2 style="color: #00ff7f; margin-bottom: 20px;">Gerenciar Benef√≠cios (VR/VA)</h2>
                <form id="benefitForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="benefitDescription">Descri√ß√£o</label>
                            <input type="text" id="benefitDescription" placeholder="Ex: Vale Refei√ß√£o, Vale Alimenta√ß√£o..." required>
                        </div>
                        <div class="form-group">
                            <label for="benefitType">Tipo de Benef√≠cio</label>
                            <select id="benefitType" required>
                                <option value="">Selecione...</option>
                                <option value="vale-refeicao">Vale Refei√ß√£o</option>
                                <option value="vale-alimentacao">Vale Alimenta√ß√£o</option>
                                <option value="vale-transporte">Vale Transporte</option>
                                <option value="outros">Outros</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="benefitDailyValue">Valor Di√°rio (R$)</label>
                            <input type="number" id="benefitDailyValue" step="0.01" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label for="benefitState">Estado (para c√°lculo de dias √∫teis)</label>
                            <select id="benefitState" required>
                                <option value="">Selecione seu estado...</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amap√°</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Cear√°</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Esp√≠rito Santo</option>
                                <option value="GO">Goi√°s</option>
                                <option value="MA">Maranh√£o</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Par√°</option>
                                <option value="PB">Para√≠ba</option>
                                <option value="PR">Paran√°</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piau√≠</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rond√¥nia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">S√£o Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="benefitPaymentDay">Dia do Cr√©dito</label>
                            <select id="benefitPaymentDay" required>
                                <option value="">Selecione...</option>
                                <option value="1">Dia 1</option>
                                <option value="5">Dia 5</option>
                                <option value="10">Dia 10</option>
                                <option value="15">Dia 15</option>
                                <option value="20">Dia 20</option>
                                <option value="25">Dia 25</option>
                                <option value="30">√öltimo dia do m√™s</option>
                            </select>
                        </div>
                    </div>
                    <div id="benefitPreview" class="installment-info" style="display: none;">
                        <p><strong>Dias √∫teis estimados/m√™s:</strong> <span id="workingDaysEstimate">22 dias</span></p>
                        <p><strong>Valor mensal estimado:</strong> <span id="monthlyBenefitEstimate">R$ 0,00</span></p>
                        <p style="color: #cccccc; font-size: 0.9em; margin-top: 10px;">
                            * Baseado na m√©dia de dias √∫teis. Feriados locais podem variar.
                        </p>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Benef√≠cio</button>
                </form>

                <div style="margin-top: 30px;">
                    <h3 style="color: #00ff7f; margin-bottom: 15px;">Benef√≠cios Cadastrados</h3>
                    <div id="benefitsList"></div>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o Proje√ß√µes -->
        <div id="projections-section" class="content-section">
            <div class="projection-container">
                <div class="projection-header">
                    <h2 style="color: #00ff7f;">Proje√ß√µes Financeiras</h2>
                    <div class="projection-controls">
                        <button class="projection-period active" onclick="updateProjection(3)">3 Meses</button>
                        <button class="projection-period" onclick="updateProjection(6)">6 Meses</button>
                        <button class="projection-period" onclick="updateProjection(12)">12 Meses</button>
                        <button class="projection-period" onclick="updateProjection('end-year')">Fim do Ano</button>
                    </div>
                </div>

                <div class="projection-grid" id="projectionResults"></div>
            </div>

            <div class="chart-container">
                <canvas id="projectionChart" class="chart-canvas"></canvas>
            </div>

            <div style="margin-top: 20px;">
                <h3 style="color: #ffa500; margin-bottom: 15px;">Gastos Parcelados Futuros</h3>
                <div id="futureInstallments"></div>
            </div>
        </div>

        <!-- Se√ß√£o Dashboard -->
        <div id="dashboard-section" class="content-section">
            <div class="filter-container">
                <label style="color: #00ff7f;">Filtros:</label>
                <input type="date" id="filterStartDate" placeholder="Data Inicial">
                <input type="date" id="filterEndDate" placeholder="Data Final">
                <select id="filterCategory">
                    <option value="">Todas as Categorias</option>
                </select>
                <button class="btn btn-primary" onclick="applyFilters()">Aplicar Filtros</button>
            </div>

            <div class="filter-container" style="justify-content: center; margin-top: 20px;">
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="importCSV(event)">
                <button class="btn btn-primary" onclick="document.getElementById('csvFileInput').click()">Importar CSV</button>
                <button class="btn btn-primary" onclick="exportCSV()">Exportar CSV</button>
                <button class="btn btn-danger" onclick="clearData()">Limpar Dados</button>
            </div>

            <div class="view-controls">
                <button class="view-btn active" onclick="showView('table')">Tabela</button>
                <button class="view-btn" onclick="showView('chart')">Gr√°fico Di√°rio</button>
                <button class="view-btn" onclick="showView('accumulated')">Acumulado</button>
                <button class="view-btn" onclick="showView('summary')">Resumo</button>
            </div>

            <!-- Visualiza√ß√£o Tabela -->
            <div id="table-view" class="view-content">
                <div class="transactions-container">
                    <div id="transactionsList"></div>
                </div>
            </div>

            <!-- Visualiza√ß√£o Gr√°fico Di√°rio -->
            <div id="chart-view" class="view-content" style="display: none;">
                <div class="chart-container">
                    <canvas id="financeChart" class="chart-canvas"></canvas>
                </div>
            </div>

            <!-- Visualiza√ß√£o Gr√°fico Acumulado -->
            <div id="accumulated-view" class="view-content" style="display: none;">
                <div class="chart-container">
                    <canvas id="accumulatedChart" class="chart-canvas"></canvas>
                </div>
            </div>

            <!-- Visualiza√ß√£o Resumo -->
            <div id="summary-view" class="view-content" style="display: none;">
                <div class="summary-grid">
                    <div class="summary-card">
                        <h4>Receitas por Categoria</h4>
                        <div id="incomeSummary"></div>
                    </div>
                    <div class="summary-card">
                        <h4>Gastos por Categoria</h4>
                        <div id="expenseSummary"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para editar benef√≠cio -->
    <div id="benefitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: #0096ff;">Editar Benef√≠cio</h3>
                <button class="close-btn" onclick="closeBenefitModal()">&times;</button>
            </div>
            <form id="editBenefitForm">
                <div class="form-group">
                    <label for="editBenefitDescription">Descri√ß√£o</label>
                    <input type="text" id="editBenefitDescription" required>
                </div>
                <div class="form-group">
                    <label for="editBenefitType">Tipo de Benef√≠cio</label>
                    <select id="editBenefitType" required>
                        <option value="vale-refeicao">Vale Refei√ß√£o</option>
                        <option value="vale-alimentacao">Vale Alimenta√ß√£o</option>
                        <option value="vale-transporte">Vale Transporte</option>
                        <option value="outros">Outros</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editBenefitDailyValue">Valor Di√°rio (R$)</label>
                    <input type="number" id="editBenefitDailyValue" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editBenefitState">Estado</label>
                    <select id="editBenefitState" required>
                        <option value="AC">Acre</option>
                        <option value="AL">Alagoas</option>
                        <option value="AP">Amap√°</option>
                        <option value="AM">Amazonas</option>
                        <option value="BA">Bahia</option>
                        <option value="CE">Cear√°</option>
                        <option value="DF">Distrito Federal</option>
                        <option value="ES">Esp√≠rito Santo</option>
                        <option value="GO">Goi√°s</option>
                        <option value="MA">Maranh√£o</option>
                        <option value="MT">Mato Grosso</option>
                        <option value="MS">Mato Grosso do Sul</option>
                        <option value="MG">Minas Gerais</option>
                        <option value="PA">Par√°</option>
                        <option value="PB">Para√≠ba</option>
                        <option value="PR">Paran√°</option>
                        <option value="PE">Pernambuco</option>
                        <option value="PI">Piau√≠</option>
                        <option value="RJ">Rio de Janeiro</option>
                        <option value="RN">Rio Grande do Norte</option>
                        <option value="RS">Rio Grande do Sul</option>
                        <option value="RO">Rond√¥nia</option>
                        <option value="RR">Roraima</option>
                        <option value="SC">Santa Catarina</option>
                        <option value="SP">S√£o Paulo</option>
                        <option value="SE">Sergipe</option>
                        <option value="TO">Tocantins</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="editBenefitPaymentDay">Dia do Cr√©dito</label>
                    <select id="editBenefitPaymentDay" required>
                        <option value="1">Dia 1</option>
                        <option value="5">Dia 5</option>
                        <option value="10">Dia 10</option>
                        <option value="15">Dia 15</option>
                        <option value="20">Dia 20</option>
                        <option value="25">Dia 25</option>
                        <option value="30">√öltimo dia do m√™s</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-danger" onclick="deleteBenefitFromModal()">Excluir Benef√≠cio</button>
                </div>
            </form>
        </div>
    </div>
    <div id="salaryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 style="color: #00ff7f;">Editar Sal√°rio</h3>
                <button class="close-btn" onclick="closeSalaryModal()">&times;</button>
            </div>
            <form id="editSalaryForm">
                <div class="form-group">
                    <label for="editSalaryDescription">Descri√ß√£o</label>
                    <input type="text" id="editSalaryDescription" required>
                </div>
                <div class="form-group">
                    <label for="editSalaryAmount">Valor Mensal (R$)</label>
                    <input type="number" id="editSalaryAmount" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="editSalaryDay">Dia do Pagamento</label>
                    <select id="editSalaryDay" required>
                        <option value="5">Dia 5</option>
                        <option value="10">Dia 10</option>
                        <option value="15">Dia 15</option>
                        <option value="20">Dia 20</option>
                        <option value="25">Dia 25</option>
                        <option value="30">√öltimo dia do m√™s</option>
                    </select>
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
                    <button type="button" class="btn btn-danger" onclick="deleteSalaryFromModal()">Excluir Sal√°rio</button>
                </div>
            </form>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Sistema de armazenamento
        let transactions = [];
        let salaries = [];
        let benefits = [];
        let chart = null;
        let accumulatedChart = null;
        let projectionChart = null;
        let currentEditingSalaryId = null;
        let currentEditingBenefitId = null;
        let currentProjectionPeriod = 3;

        // Feriados nacionais fixos (sem considerar feriados m√≥veis como P√°scoa para simplificar)
        const nationalHolidays = [
            '01-01', // Confraterniza√ß√£o Universal
            '04-21', // Tiradentes
            '05-01', // Dia do Trabalhador
            '09-07', // Independ√™ncia do Brasil
            '10-12', // Nossa Senhora Aparecida
            '11-02', // Finados
            '11-15', // Proclama√ß√£o da Rep√∫blica
            '12-25'  // Natal
        ];

        // Feriados estaduais (alguns exemplos principais)
        const stateHolidays = {
            'AC': ['06-15', '09-05'], // Dia da Amaz√¥nia, Dia da Amaz√¥nia
            'AL': ['06-29', '09-29'], // S√£o Pedro e S√£o Paulo, Emancipa√ß√£o de Alagoas
            'AP': ['03-19', '09-13'], // Dia de S√£o Jos√©, Cria√ß√£o do Territ√≥rio
            'AM': ['09-05', '11-20'], // Eleva√ß√£o √† categoria de estado, Consci√™ncia Negra
            'BA': ['07-02'], // Independ√™ncia da Bahia
            'CE': ['03-25'], // Data Magna do Cear√°
            'DF': ['04-21', '11-30'], // Tiradentes, Dia do Evang√©lico
            'ES': [], // Sem feriados estaduais espec√≠ficos principais
            'GO': [], // Sem feriados estaduais espec√≠ficos principais
            'MA': ['07-28'], // Ades√£o do Maranh√£o √† Independ√™ncia
            'MT': ['11-20'], // Consci√™ncia Negra
            'MS': ['10-11'], // Cria√ß√£o do estado
            'MG': ['04-21'], // Tiradentes
            'PA': ['08-15'], // Ades√£o do Gr√£o-Par√° √† Independ√™ncia
            'PB': ['08-05'], // Funda√ß√£o do Estado
            'PR': ['12-19'], // Emancipa√ß√£o do Paran√°
            'PE': [], // Sem feriados estaduais espec√≠ficos principais
            'PI': ['10-19'], // Dia do Piau√≠
            'RJ': ['04-23', '11-20'], // S√£o Jorge, Consci√™ncia Negra
            'RN': ['10-03'], // M√°rtires de Cunha√∫ e Urua√ßuu
            'RS': ['09-20'], // Revolu√ß√£o Farroupilha
            'RO': ['01-04', '06-18'], // Cria√ß√£o do estado, Dia do Evang√©lico
            'RR': ['10-05'], // Cria√ß√£o de Roraima
            'SC': [], // Sem feriados estaduais espec√≠ficos principais
            'SP': ['07-09'], // Revolu√ß√£o Constitucionalista
            'SE': ['07-08'], // Emancipa√ß√£o de Sergipe
            'TO': ['10-05'] // Cria√ß√£o de Tocantins
        };

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('incomeDate').value = today;
            document.getElementById('expenseDate').value = today;
            
            loadData();
            updateDisplay();
            populateCategories();
            setupInstallmentCalculator();
            setupBenefitCalculator();

            // Event listeners
            document.getElementById('incomeForm').addEventListener('submit', addIncome);
            document.getElementById('expenseForm').addEventListener('submit', addExpense);
            document.getElementById('salaryForm').addEventListener('submit', addSalary);
            document.getElementById('editSalaryForm').addEventListener('submit', updateSalary);
            document.getElementById('benefitForm').addEventListener('submit', addBenefit);
            document.getElementById('editBenefitForm').addEventListener('submit', updateBenefit);
        });

        function setupInstallmentCalculator() {
            const installmentsSelect = document.getElementById('installments');
            const expenseAmount = document.getElementById('expenseAmount');
            const expenseDate = document.getElementById('expenseDate');
            const installmentInfo = document.getElementById('installmentInfo');

            function updateInstallmentInfo() {
                const amount = parseFloat(expenseAmount.value) || 0;
                const installments = parseInt(installmentsSelect.value) || 1;
                const startDate = new Date(expenseDate.value);

                if (installments > 1 && amount > 0 && expenseDate.value) {
                    const amountPerInstallment = amount / installments;
                    const lastDate = new Date(startDate);
                    lastDate.setMonth(lastDate.getMonth() + installments - 1);

                    document.getElementById('installmentAmount').textContent = formatCurrency(amountPerInstallment);
                    document.getElementById('firstInstallment').textContent = formatDate(expenseDate.value);
                    document.getElementById('lastInstallment').textContent = formatDate(lastDate.toISOString().split('T')[0]);
                    
                    installmentInfo.style.display = 'block';
                } else {
                    installmentInfo.style.display = 'none';
                }
            }

            installmentsSelect.addEventListener('change', updateInstallmentInfo);
            expenseAmount.addEventListener('input', updateInstallmentInfo);
        }

        function setupBenefitCalculator() {
            const dailyValue = document.getElementById('benefitDailyValue');
            const state = document.getElementById('benefitState');
            const preview = document.getElementById('benefitPreview');

            function updateBenefitPreview() {
                const value = parseFloat(dailyValue.value) || 0;
                const selectedState = state.value;

                if (value > 0 && selectedState) {
                    const workingDays = calculateWorkingDays(selectedState);
                    const monthlyEstimate = value * workingDays;

                    document.getElementById('workingDaysEstimate').textContent = `${workingDays} dias`;
                    document.getElementById('monthlyBenefitEstimate').textContent = formatCurrency(monthlyEstimate);
                    
                    preview.style.display = 'block';
                } else {
                    preview.style.display = 'none';
                }
            }

            dailyValue.addEventListener('input', updateBenefitPreview);
            state.addEventListener('change', updateBenefitPreview);
        }

        function calculateWorkingDays(state) {
            // Base: 22 dias √∫teis em m√©dia por m√™s (considerando fins de semana)
            let workingDays = 22;
            
            // Subtrair feriados nacionais que caem em dias √∫teis (estimativa: 6-7 por ano)
            const nationalHolidaysPerMonth = 6 / 12; // ~0.5 por m√™s
            
            // Subtrair feriados estaduais
            const stateHolidaysCount = stateHolidays[state] ? stateHolidays[state].length : 0;
            const stateHolidaysPerMonth = stateHolidaysCount / 12;
            
            // C√°lculo final (arredondado)
            workingDays = Math.round(workingDays - nationalHolidaysPerMonth - stateHolidaysPerMonth);
            
            // Garantir m√≠nimo de 20 e m√°ximo de 23 dias
            return Math.max(20, Math.min(23, workingDays));
        }

        function showSection(section) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));

            event.target.classList.add('active');
            document.getElementById(section + '-section').classList.add('active');

            if (section === 'dashboard') {
                updateDisplay();
                showView('table');
            } else if (section === 'salaries') {
                displaySalaries();
            } else if (section === 'benefits') {
                displayBenefits();
            } else if (section === 'projections') {
                updateProjection(currentProjectionPeriod);
            }
        }

        function showView(viewType) {
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            document.querySelectorAll('.view-content').forEach(view => view.style.display = 'none');
            document.getElementById(viewType + '-view').style.display = 'block';

            if (viewType === 'table') {
                displayTransactions();
            } else if (viewType === 'chart') {
                displayChart();
            } else if (viewType === 'accumulated') {
                displayAccumulatedChart();
            } else if (viewType === 'summary') {
                displaySummary();
            }
        }

        function addIncome(e) {
            e.preventDefault();
            const form = e.target;
            const transaction = {
                id: Date.now(),
                type: 'income',
                description: form.incomeDescription.value,
                amount: parseFloat(form.incomeAmount.value),
                date: form.incomeDate.value,
                category: form.incomeCategory.value
            };

            transactions.push(transaction);
            saveData();
            updateDisplay();
            form.reset();
            
            form.incomeDate.value = new Date().toISOString().split('T')[0];
            showNotification('Receita adicionada com sucesso!', 'success');
        }

        function addExpense(e) {
            e.preventDefault();
            const form = e.target;
            const amount = parseFloat(form.expenseAmount.value);
            const installments = parseInt(form.installments.value);
            const startDate = new Date(form.expenseDate.value);

            if (installments === 1) {
                // Gasto √† vista
                const transaction = {
                    id: Date.now(),
                    type: 'expense',
                    description: form.expenseDescription.value,
                    amount: amount,
                    date: form.expenseDate.value,
                    category: form.expenseCategory.value
                };
                transactions.push(transaction);
            } else {
                // Gasto parcelado
                const amountPerInstallment = amount / installments;
                for (let i = 0; i < installments; i++) {
                    const installmentDate = new Date(startDate);
                    installmentDate.setMonth(installmentDate.getMonth() + i);
                    
                    const transaction = {
                        id: Date.now() + i,
                        type: 'expense',
                        description: `${form.expenseDescription.value} (${i + 1}/${installments})`,
                        amount: amountPerInstallment,
                        date: installmentDate.toISOString().split('T')[0],
                        category: form.expenseCategory.value,
                        isInstallment: true,
                        installmentInfo: {
                            current: i + 1,
                            total: installments,
                            originalAmount: amount,
                            originalDescription: form.expenseDescription.value
                        }
                    };
                    transactions.push(transaction);
                }
            }

            saveData();
            updateDisplay();
            form.reset();
            
            form.expenseDate.value = new Date().toISOString().split('T')[0];
            form.installments.value = '1';
            document.getElementById('installmentInfo').style.display = 'none';
            
            showNotification(`Gasto ${installments > 1 ? 'parcelado ' : ''}adicionado com sucesso!`, 'success');
        }

        function addSalary(e) {
            e.preventDefault();
            const form = e.target;
            
            const salary = {
                id: Date.now(),
                description: form.salaryDescription.value,
                amount: parseFloat(form.salaryAmount.value),
                paymentDay: parseInt(form.salaryDay.value)
            };

            salaries.push(salary);
            saveData();
            displaySalaries();
            form.reset();
           
        }
        
        function addBenefit(e) {
            e.preventDefault();
            const form = e.target;
            
            const dailyValue = parseFloat(form.benefitDailyValue.value);
            const state = form.benefitState.value;
            const workingDays = calculateWorkingDays(state);
            const monthlyAmount = dailyValue * workingDays;
            
            const benefit = {
                id: Date.now(),
                description: form.benefitDescription.value,
                type: form.benefitType.value,
                dailyValue: dailyValue,
                monthlyAmount: monthlyAmount,
                state: state,
                workingDays: workingDays,
                paymentDay: parseInt(form.benefitPaymentDay.value)
            };

            benefits.push(benefit);
            saveData();
            displayBenefits();
            form.reset();
            document.getElementById('benefitPreview').style.display = 'none';
            
            showNotification('Benef√≠cio adicionado com sucesso!', 'success');
        }

        function displayBenefits() {
            const container = document.getElementById('benefitsList');
            
            if (benefits.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 3em; color: #0096ff;">üé´</div>
                        <h3>Nenhum benef√≠cio cadastrado</h3>
                        <p>Adicione seus vales para proje√ß√µes autom√°ticas</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = benefits.map(benefit => `
                <div class="benefit-item">
                    <div class="benefit-info">
                        <div class="benefit-amount">${formatCurrency(benefit.monthlyAmount)}/m√™s</div>
                        <div class="benefit-description">${benefit.description} - ${getBenefitTypeLabel(benefit.type)}</div>
                        <div class="benefit-details">
                            ${formatCurrency(benefit.dailyValue)}/dia √ó ${benefit.workingDays} dias √∫teis (${benefit.state}) ‚Ä¢ Cr√©dito dia ${benefit.paymentDay === 30 ? '√∫ltimo do m√™s' : benefit.paymentDay}
                        </div>
                    </div>
                    <button class="btn btn-secondary btn-small" onclick="editBenefit(${benefit.id})">Editar</button>
                    <button class="btn btn-danger btn-small" onclick="deleteBenefit(${benefit.id})">Excluir</button>
                </div>
            `).join('');
        }

        function getBenefitTypeLabel(type) {
            const labels = {
                'vale-refeicao': 'Vale Refei√ß√£o',
                'vale-alimentacao': 'Vale Alimenta√ß√£o',
                'vale-transporte': 'Vale Transporte',
                'outros': 'Outros'
            };
            return labels[type] || type;
        }

        function editBenefit(id) {
            const benefit = benefits.find(b => b.id === id);
            if (!benefit) return;

            currentEditingBenefitId = id;
            document.getElementById('editBenefitDescription').value = benefit.description;
            document.getElementById('editBenefitType').value = benefit.type;
            document.getElementById('editBenefitDailyValue').value = benefit.dailyValue;
            document.getElementById('editBenefitState').value = benefit.state;
            document.getElementById('editBenefitPaymentDay').value = benefit.paymentDay;
            
            document.getElementById('benefitModal').style.display = 'block';
        }

        function updateBenefit(e) {
            e.preventDefault();
            const form = e.target;
            
            const benefitIndex = benefits.findIndex(b => b.id === currentEditingBenefitId);
            if (benefitIndex === -1) return;

            const dailyValue = parseFloat(form.editBenefitDailyValue.value);
            const state = form.editBenefitState.value;
            const workingDays = calculateWorkingDays(state);
            const monthlyAmount = dailyValue * workingDays;

            benefits[benefitIndex] = {
                ...benefits[benefitIndex],
                description: form.editBenefitDescription.value,
                type: form.editBenefitType.value,
                dailyValue: dailyValue,
                monthlyAmount: monthlyAmount,
                state: state,
                workingDays: workingDays,
                paymentDay: parseInt(form.editBenefitPaymentDay.value)
            };

            saveData();
            displayBenefits();
            closeBenefitModal();
            showNotification('Benef√≠cio atualizado com sucesso!', 'success');
        }

        function deleteBenefit(id) {
            if (confirm('Tem certeza que deseja excluir este benef√≠cio?')) {
                benefits = benefits.filter(b => b.id !== id);
                saveData();
                displayBenefits();
                showNotification('Benef√≠cio exclu√≠do com sucesso!', 'success');
            }
        }

        function deleteBenefitFromModal() {
            if (confirm('Tem certeza que deseja excluir este benef√≠cio?')) {
                benefits = benefits.filter(b => b.id !== currentEditingBenefitId);
                saveData();
                displayBenefits();
                closeBenefitModal();
                showNotification('Benef√≠cio exclu√≠do com sucesso!', 'success');
            }
        }

        function updateSalary(e) {
            e.preventDefault();
            const form = e.target;
            
            const salaryIndex = salaries.findIndex(s => s.id === currentEditingSalaryId);
            if (salaryIndex === -1) return;

            salaries[salaryIndex] = {
                ...salaries[salaryIndex],
                description: form.editSalaryDescription.value,
                amount: parseFloat(form.editSalaryAmount.value),
                paymentDay: parseInt(form.editSalaryDay.value)
            };

            saveData();
            displaySalaries();
            closeSalaryModal();
            showNotification('Sal√°rio atualizado com sucesso!', 'success');
        }

        function deleteSalary(id) {
            if (confirm('Tem certeza que deseja excluir este sal√°rio?')) {
                salaries = salaries.filter(s => s.id !== id);
                saveData();
                displaySalaries();
                showNotification('Sal√°rio exclu√≠do com sucesso!', 'success');
            }
        }

        function deleteSalaryFromModal() {
            if (confirm('Tem certeza que deseja excluir este sal√°rio?')) {
                salaries = salaries.filter(s => s.id !== currentEditingSalaryId);
                saveData();
                displaySalaries();
                closeSalaryModal();
                showNotification('Sal√°rio exclu√≠do com sucesso!', 'success');
            }
        }

        function closeSalaryModal() {
            document.getElementById('salaryModal').style.display = 'none';
            currentEditingSalaryId = null;
        }

        function displaySalaries() {
            const container = document.getElementById('salariesList');
            
            if (salaries.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 3em; color: #00ff7f;">üí∞</div>
                        <h3>Nenhum sal√°rio cadastrado</h3>
                        <p>Adicione seus sal√°rios mensais para proje√ß√µes autom√°ticas</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = salaries.map(salary => `
                <div class="salary-item">
                    <div class="salary-info">
                        <div class="salary-amount">${formatCurrency(salary.amount)}</div>
                        <div class="salary-description">${salary.description} - Todo dia ${salary.paymentDay === 30 ? '√∫ltimo do m√™s' : salary.paymentDay}</div>
                    </div>
                    <button class="btn btn-secondary btn-small" onclick="editSalary(${salary.id})">Editar</button>
                    <button class="btn btn-danger btn-small" onclick="deleteSalary(${salary.id})">Excluir</button>
                </div>
            `).join('');
        }

        function editSalary(id) {
            const salary = salaries.find(s => s.id === id);
            if (!salary) return;

            currentEditingSalaryId = id;
            document.getElementById('editSalaryDescription').value = salary.description;
            document.getElementById('editSalaryAmount').value = salary.amount;
            document.getElementById('editSalaryDay').value = salary.paymentDay;
            
            document.getElementById('salaryModal').style.display = 'block';
        }

        function updateSalary(e) {
            e.preventDefault();
            const form = e.target;
            
            const salaryIndex = salaries.findIndex(s => s.id === currentEditingSalaryId);
            if (salaryIndex === -1) return;

            salaries[salaryIndex] = {
                ...salaries[salaryIndex],
                description: form.editSalaryDescription.value,
                amount: parseFloat(form.editSalaryAmount.value),
                paymentDay: parseInt(form.editSalaryDay.value)
            };

            saveData();
            displaySalaries();
            closeSalaryModal();
            showNotification('Sal√°rio atualizado com sucesso!', 'success');
        }

        function deleteSalary(id) {
            if (confirm('Tem certeza que deseja excluir este sal√°rio?')) {
                salaries = salaries.filter(s => s.id !== id);
                saveData();
                displaySalaries();
                showNotification('Sal√°rio exclu√≠do com sucesso!', 'success');
            }
        }

        function deleteSalaryFromModal() {
            if (confirm('Tem certeza que deseja excluir este sal√°rio?')) {
                salaries = salaries.filter(s => s.id !== currentEditingSalaryId);
                saveData();
                displaySalaries();
                closeSalaryModal();
                showNotification('Sal√°rio exclu√≠do com sucesso!', 'success');
            }
        }

        function closeSalaryModal() {
            document.getElementById('salaryModal').style.display = 'none';
            currentEditingSalaryId = null;
        }

        function updateProjection(period) {
            currentProjectionPeriod = period;
            
            // Atualizar bot√µes ativos
            document.querySelectorAll('.projection-period').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const today = new Date();
            let endDate;

            if (period === 'end-year') {
                endDate = new Date(today.getFullYear(), 11, 31);
            } else {
                endDate = new Date(today);
                endDate.setMonth(endDate.getMonth() + period);
            }

            const projectionData = calculateProjection(today, endDate);
            displayProjectionResults(projectionData, period);
            displayProjectionChart(projectionData);
            displayFutureInstallments(endDate);
        }

        function calculateProjection(startDate, endDate) {
            const monthlyData = {};
            const currentMonth = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
            
            // Inicializar meses no per√≠odo
            const current = new Date(currentMonth);
            while (current <= endDate) {
                const monthKey = `${current.getFullYear()}-${String(current.getMonth() + 1).padStart(2, '0')}`;
                monthlyData[monthKey] = {
                    salaries: 0,
                    benefits: 0,
                    installments: 0,
                    total: 0
                };
                current.setMonth(current.getMonth() + 1);
            }

            // Calcular sal√°rios e benef√≠cios futuros
            Object.keys(monthlyData).forEach(monthKey => {
                const [year, month] = monthKey.split('-').map(Number);
                const monthSalaries = salaries.reduce((sum, salary) => sum + salary.amount, 0);
                const monthBenefits = benefits.reduce((sum, benefit) => sum + benefit.monthlyAmount, 0);
                monthlyData[monthKey].salaries = monthSalaries;
                monthlyData[monthKey].benefits = monthBenefits;
            });

            // Calcular parcelas futuras
            transactions.forEach(transaction => {
                if (transaction.isInstallment && new Date(transaction.date) > startDate && new Date(transaction.date) <= endDate) {
                    const transactionDate = new Date(transaction.date);
                    const monthKey = `${transactionDate.getFullYear()}-${String(transactionDate.getMonth() + 1).padStart(2, '0')}`;
                    if (monthlyData[monthKey]) {
                        monthlyData[monthKey].installments += transaction.amount;
                    }
                }
            });

            // Calcular totais mensais
            Object.keys(monthlyData).forEach(monthKey => {
                const data = monthlyData[monthKey];
                data.total = (data.salaries + data.benefits) - data.installments;
            });

            return monthlyData;
        }

        function displayProjectionResults(projectionData, period) {
            const container = document.getElementById('projectionResults');
            
            const totalSalaries = Object.values(projectionData).reduce((sum, month) => sum + month.salaries, 0);
            const totalBenefits = Object.values(projectionData).reduce((sum, month) => sum + month.benefits, 0);
            const totalInstallments = Object.values(projectionData).reduce((sum, month) => sum + month.installments, 0);
            const projectedBalance = (totalSalaries + totalBenefits) - totalInstallments;
            const monthsCount = Object.keys(projectionData).length;

            const periodText = period === 'end-year' ? 'at√© o fim do ano' : `pr√≥ximos ${period} meses`;

            container.innerHTML = `
                <div class="projection-card">
                    <h5>Sal√°rios Projetados</h5>
                    <div class="projection-value positive">${formatCurrency(totalSalaries)}</div>
                </div>
                <div class="projection-card">
                    <h5>Benef√≠cios Projetados</h5>
                    <div class="projection-value" style="color: #0096ff;">${formatCurrency(totalBenefits)}</div>
                </div>
                <div class="projection-card">
                    <h5>Gastos Parcelados</h5>
                    <div class="projection-value negative">${formatCurrency(totalInstallments)}</div>
                </div>
                <div class="projection-card">
                    <h5>Resultado Projetado</h5>
                    <div class="projection-value ${projectedBalance >= 0 ? 'positive' : 'negative'}">${formatCurrency(projectedBalance)}</div>
                </div>
                <div class="projection-card">
                    <h5>M√©dia Mensal</h5>
                    <div class="projection-value ${projectedBalance >= 0 ? 'positive' : 'negative'}">${formatCurrency(projectedBalance / monthsCount)}</div>
                </div>
            `;
        }

        function displayProjectionChart(projectionData) {
            const ctx = document.getElementById('projectionChart').getContext('2d');
            
            if (projectionChart) {
                projectionChart.destroy();
            }

            const months = Object.keys(projectionData).sort();
            const salariesData = months.map(month => projectionData[month].salaries);
            const benefitsData = months.map(month => projectionData[month].benefits);
            const installmentsData = months.map(month => projectionData[month].installments);
            const balanceData = months.map(month => projectionData[month].total);

            const labels = months.map(month => {
                const [year, monthNum] = month.split('-');
                const monthNames = ['Jan', 'Fev', 'Mar', 'Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out', 'Nov', 'Dez'];
                return `${monthNames[parseInt(monthNum) - 1]}/${year}`;
            });

            projectionChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Sal√°rios',
                        data: salariesData,
                        backgroundColor: 'rgba(0, 255, 127, 0.6)',
                        borderColor: '#00ff7f',
                        borderWidth: 2
                    }, {
                        label: 'Benef√≠cios (VR/VA)',
                        data: benefitsData,
                        backgroundColor: 'rgba(0, 150, 255, 0.6)',
                        borderColor: '#0096ff',
                        borderWidth: 2
                    }, {
                        label: 'Gastos Parcelados',
                        data: installmentsData,
                        backgroundColor: 'rgba(255, 71, 87, 0.6)',
                        borderColor: '#ff4757',
                        borderWidth: 2
                    }, {
                        label: 'Resultado Mensal',
                        data: balanceData,
                        type: 'line',
                        borderColor: '#ffa500',
                        backgroundColor: 'rgba(255, 165, 0, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 6,
                        pointBackgroundColor: '#ffa500',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Proje√ß√£o Financeira Futura',
                            color: '#00ff7f',
                            font: { size: 16 }
                        },
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function displayFutureInstallments(endDate) {
            const container = document.getElementById('futureInstallments');
            
            const futureInstallments = transactions.filter(t => 
                t.isInstallment && 
                new Date(t.date) > new Date() && 
                new Date(t.date) <= endDate
            ).sort((a, b) => new Date(a.date) - new Date(b.date));

            if (futureInstallments.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 2em; color: #ffa500;">üìÖ</div>
                        <h4>Nenhuma parcela futura encontrada</h4>
                        <p>Gastos parcelados aparecer√£o aqui</p>
                    </div>
                `;
                return;
            }

            // Agrupar por m√™s
            const byMonth = {};
            futureInstallments.forEach(installment => {
                const date = new Date(installment.date);
                const monthKey = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
                if (!byMonth[monthKey]) {
                    byMonth[monthKey] = [];
                }
                byMonth[monthKey].push(installment);
            });

            container.innerHTML = Object.keys(byMonth).sort().map(monthKey => {
                const [year, month] = monthKey.split('-');
                const monthNames = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const monthTotal = byMonth[monthKey].reduce((sum, t) => sum + t.amount, 0);
                
                return `
                    <div class="summary-card">
                        <h4>${monthNames[parseInt(month) - 1]} ${year} - ${formatCurrency(monthTotal)}</h4>
                        ${byMonth[monthKey].map(installment => `
                            <div class="summary-item">
                                <span>${installment.description}</span>
                                <span style="color: #ff4757;">${formatCurrency(installment.amount)}</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            }).join('');
        }

        function updateDisplay() {
            const income = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const expenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const balance = income - expenses;

            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
            
            const balanceElement = document.getElementById('currentBalance');
            balanceElement.textContent = formatCurrency(balance);
            balanceElement.className = `balance-amount ${balance >= 0 ? 'positive' : 'negative'}`;
        }

        function displayTransactions() {
            const container = document.getElementById('transactionsList');
            const filtered = getFilteredTransactions();
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 3em; color: #00ff7f;">+</div>
                        <h3>Nenhuma transa√ß√£o encontrada</h3>
                        <p>Adicione receitas e gastos para come√ßar a acompanhar suas finan√ßas</p>
                    </div>
                `;
                return;
            }

            const sortedTransactions = [...filtered].sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = sortedTransactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-date">${formatDate(transaction.date)}</div>
                    <div class="transaction-description">
                        ${transaction.description}
                        ${transaction.isInstallment ? `<div class="installment-badge">${transaction.installmentInfo.current}/${transaction.installmentInfo.total}</div>` : ''}
                    </div>
                    <div class="transaction-category">${transaction.category}</div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'} ${formatCurrency(transaction.amount)}
                    </div>
                    <button class="btn btn-danger btn-small" onclick="deleteTransaction(${transaction.id})">Excluir</button>
                </div>
            `).join('');
        }

        function displayChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            const filtered = getFilteredTransactions();
            const dailyData = {};
            
            filtered.forEach(transaction => {
                const date = transaction.date;
                if (!dailyData[date]) {
                    dailyData[date] = { income: 0, expense: 0 };
                }
                if (transaction.type === 'income') {
                    dailyData[date].income += transaction.amount;
                } else {
                    dailyData[date].expense += transaction.amount;
                }
            });

            const dates = Object.keys(dailyData).sort();
            const incomeData = dates.map(date => dailyData[date].income);
            const expenseData = dates.map(date => dailyData[date].expense);

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(date => formatDate(date)),
                    datasets: [{
                        label: 'Receitas Di√°rias',
                        data: incomeData,
                        borderColor: '#00ff7f',
                        backgroundColor: 'rgba(0, 255, 127, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Gastos Di√°rios',
                        data: expenseData,
                        borderColor: '#ff4757',
                        backgroundColor: 'rgba(255, 71, 87, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Fluxo Financeiro Di√°rio',
                            color: '#00ff7f',
                            font: { size: 16 }
                        },
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function displayAccumulatedChart() {
            const ctx = document.getElementById('accumulatedChart').getContext('2d');
            
            if (accumulatedChart) {
                accumulatedChart.destroy();
            }

            const filtered = getFilteredTransactions();

            if (filtered.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#cccccc';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Nenhum dado para exibir', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            const dailyData = {};
            filtered.forEach(transaction => {
                const date = transaction.date;
                if (!dailyData[date]) {
                    dailyData[date] = { income: 0, expense: 0 };
                }
                if (transaction.type === 'income') {
                    dailyData[date].income += transaction.amount;
                } else {
                    dailyData[date].expense += transaction.amount;
                }
            });

            const sortedDates = Object.keys(dailyData).sort();
            let runningIncome = 0;
            let runningExpense = 0;
            let runningBalance = 0;
            
            const accumulatedData = sortedDates.map(date => {
                runningIncome += dailyData[date].income;
                runningExpense += dailyData[date].expense;
                runningBalance = runningIncome - runningExpense;
                
                return {
                    date: date,
                    accumulatedIncome: runningIncome,
                    accumulatedExpense: runningExpense,
                    balance: runningBalance,
                    dailyIncome: dailyData[date].income,
                    dailyExpense: dailyData[date].expense
                };
            });

            const labels = accumulatedData.map(item => formatDate(item.date));
            const incomeData = accumulatedData.map(item => item.accumulatedIncome);
            const expenseData = accumulatedData.map(item => item.accumulatedExpense);
            const balanceData = accumulatedData.map(item => item.balance);

            accumulatedChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Receitas Acumuladas',
                        data: incomeData,
                        borderColor: '#00ff7f',
                        backgroundColor: 'rgba(0, 255, 127, 0.1)',
                        borderWidth: 3,
                        fill: '+1',
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#00ff7f',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }, {
                        label: 'Gastos Acumulados',
                        data: expenseData,
                        borderColor: '#ff4757',
                        backgroundColor: 'rgba(255, 71, 87, 0.1)',
                        borderWidth: 3,
                        fill: 'origin',
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#ff4757',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }, {
                        label: 'Saldo L√≠quido',
                        data: balanceData,
                        borderColor: '#ffa500',
                        backgroundColor: 'rgba(255, 165, 0, 0.1)',
                        borderWidth: 4,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#ffa500',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evolu√ß√£o Patrimonial - Valores Acumulados',
                            color: '#00ff7f',
                            font: { size: 18, weight: 'bold' }
                        },
                        legend: {
                            labels: {
                                color: '#ffffff',
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const datasetLabel = context.dataset.label;
                                    const value = context.parsed.y;
                                    return `${datasetLabel}: ${formatCurrency(value)}`;
                                },
                                afterLabel: function(context) {
                                    const dataIndex = context.dataIndex;
                                    const dailyData = accumulatedData[dataIndex];
                                    if (context.datasetIndex === 2) {
                                        return [
                                            `--- Movimento do Dia ---`,
                                            `Receita: ${formatCurrency(dailyData.dailyIncome)}`,
                                            `Gasto: ${formatCurrency(dailyData.dailyExpense)}`,
                                            `Resultado: ${formatCurrency(dailyData.dailyIncome - dailyData.dailyExpense)}`
                                        ];
                                    }
                                    return null;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function displaySummary() {
            const incomeByCategory = {};
            const expenseByCategory = {};

            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    incomeByCategory[transaction.category] = (incomeByCategory[transaction.category] || 0) + transaction.amount;
                } else {
                    expenseByCategory[transaction.category] = (expenseByCategory[transaction.category] || 0) + transaction.amount;
                }
            });

            const incomeSummary = document.getElementById('incomeSummary');
            if (Object.keys(incomeByCategory).length === 0) {
                incomeSummary.innerHTML = '<p style="color: #cccccc;">Nenhuma receita registrada</p>';
            } else {
                incomeSummary.innerHTML = Object.entries(incomeByCategory)
                    .sort((a, b) => b[1] - a[1])
                    .map(([category, amount]) => `
                        <div class="summary-item">
                            <span>${category}</span>
                            <span style="color: #00ff7f;">${formatCurrency(amount)}</span>
                        </div>
                    `).join('');
            }

            const expenseSummary = document.getElementById('expenseSummary');
            if (Object.keys(expenseByCategory).length === 0) {
                expenseSummary.innerHTML = '<p style="color: #cccccc;">Nenhum gasto registrado</p>';
            } else {
                expenseSummary.innerHTML = Object.entries(expenseByCategory)
                    .sort((a, b) => b[1] - a[1])
                    .map(([category, amount]) => `
                        <div class="summary-item">
                            <span>${category}</span>
                            <span style="color: #ff4757;">${formatCurrency(amount)}</span>
                        </div>
                    `).join('');
            }
        }

        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData();
                updateDisplay();
                displayTransactions();
                showNotification('Transa√ß√£o exclu√≠da com sucesso!', 'success');
            }
        }

        function populateCategories() {
            const incomeCategories = ['Sal√°rio', 'Freelance', 'Investimentos', 'Vendas', 'Outros'];
            const expenseCategories = ['Alimenta√ß√£o', 'Transporte', 'Moradia', 'Sa√∫de', 'Educa√ß√£o', 'Lazer', 'Vestu√°rio', 'Outros'];
            
            const filterCategory = document.getElementById('filterCategory');
            filterCategory.innerHTML = '<option value="">Todas as Categorias</option>';
            
            [...new Set([...incomeCategories, ...expenseCategories])].forEach(category => {
                filterCategory.innerHTML += `<option value="${category}">${category}</option>`;
            });
        }

        function applyFilters() {
            displayTransactions();
            showNotification('Filtros aplicados!', 'info');
        }

        function getFilteredTransactions() {
            let filtered = [...transactions];
            
            const startDate = document.getElementById('filterStartDate').value;
            const endDate = document.getElementById('filterEndDate').value;
            const category = document.getElementById('filterCategory').value;

            if (startDate) {
                filtered = filtered.filter(t => t.date >= startDate);
            }

            if (endDate) {
                filtered = filtered.filter(t => t.date <= endDate);
            }

            if (category) {
                filtered = filtered.filter(t => t.category === category);
            }

            return filtered;
        }

        function clearData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                transactions = [];
                salaries = [];
                benefits = [];
                saveData();
                updateDisplay();
                displayTransactions();
                displaySalaries();
                displayBenefits();
                if (chart) chart.destroy();
                if (accumulatedChart) accumulatedChart.destroy();
                if (projectionChart) projectionChart.destroy();
                
                document.getElementById('filterStartDate').value = '';
                document.getElementById('filterEndDate').value = '';
                document.getElementById('filterCategory').value = '';
                
                showNotification('Todos os dados foram limpos!', 'info');
            }
        }

        function exportCSV() {
            if (transactions.length === 0 && salaries.length === 0) {
                showNotification('Nenhum dado para exportar!', 'error');
                return;
            }

            const headers = ['Data', 'Tipo', 'Descri√ß√£o', 'Categoria', 'Valor', 'Parcela'];
            
            const csvData = transactions.map(transaction => [
                transaction.date,
                transaction.type === 'income' ? 'Receita' : 'Gasto',
                `"${transaction.description}"`,
                transaction.category,
                transaction.amount.toFixed(2),
                transaction.isInstallment ? `${transaction.installmentInfo.current}/${transaction.installmentInfo.total}` : ''
            ]);

            const csvContent = [headers, ...csvData]
                .map(row => row.join(','))
                .join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const today = new Date().toISOString().split('T')[0];
            link.setAttribute('href', url);
            link.setAttribute('download', `financas_${today}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('Dados exportados com sucesso!', 'success');
        }

        function importCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                showNotification('Por favor, selecione um arquivo CSV v√°lido!', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csvText = e.target.result;
                    const lines = csvText.split('\n').filter(line => line.trim());
                    
                    if (lines.length < 2) {
                        showNotification('Arquivo CSV vazio ou inv√°lido!', 'error');
                        return;
                    }

                    const dataLines = lines.slice(1);
                    let importCount = 0;
                    let errorCount = 0;

                    dataLines.forEach((line, index) => {
                        try {
                            const values = parseCSVLine(line);
                            
                            if (values.length >= 5) {
                                const [date, type, description, category, amount, installmentInfo] = values;
                                
                                if (date && (type === 'Receita' || type === 'Gasto') && description && category && !isNaN(parseFloat(amount))) {
                                    const transaction = {
                                        id: Date.now() + index,
                                        type: type === 'Receita' ? 'income' : 'expense',
                                        description: description.replace(/^"|"$/g, ''),
                                        amount: parseFloat(amount),
                                        date: date,
                                        category: category
                                    };

                                    if (installmentInfo && installmentInfo.includes('/')) {
                                        const [current, total] = installmentInfo.split('/').map(Number);
                                        transaction.isInstallment = true;
                                        transaction.installmentInfo = {
                                            current: current,
                                            total: total,
                                            originalAmount: parseFloat(amount) * total,
                                            originalDescription: description.replace(/^"|"$/g, '').replace(/ \(\d+\/\d+\)$/, '')
                                        };
                                    }
                                    
                                    transactions.push(transaction);
                                    importCount++;
                                } else {
                                    errorCount++;
                                }
                            } else {
                                errorCount++;
                            }
                        } catch (error) {
                            errorCount++;
                        }
                    });

                    saveData();
                    updateDisplay();
                    displayTransactions();
                    
                    if (importCount > 0) {
                        showNotification(`${importCount} transa√ß√µes importadas com sucesso! ${errorCount > 0 ? `(${errorCount} linhas com erro)` : ''}`, 'success');
                    } else {
                        showNotification('Nenhuma transa√ß√£o v√°lida encontrada no arquivo!', 'error');
                    }

                } catch (error) {
                    showNotification('Erro ao processar arquivo CSV!', 'error');
                    console.error('Erro na importa√ß√£o:', error);
                }

                event.target.value = '';
            };

            reader.readAsText(file);
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        function saveData() {
            try {
                const data = {
                    transactions: transactions,
                    salaries: salaries,
                    benefits: benefits
                };
                localStorage.setItem('moneyTrackerData', JSON.stringify(data));
            } catch (error) {
                console.warn('Erro ao salvar dados no localStorage:', error);
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('moneyTrackerData');
                if (saved) {
                    const data = JSON.parse(saved);
                    transactions = data.transactions || [];
                    salaries = data.salaries || [];
                    benefits = data.benefits || [];
                    return;
                }
            } catch (error) {
                console.warn('Erro ao carregar dados do localStorage:', error);
            }
            
            // Inicializar com dados vazios se n√£o h√° dados salvos
            transactions = [];
            salaries = [];
            benefits = [];
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(0, 255, 127, 0.9)' : 
                             type === 'error' ? 'rgba(255, 71, 87, 0.9)' : 
                             'rgba(0, 150, 255, 0.9)'};
                color: ${type === 'success' ? '#000' : '#fff'};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                word-wrap: break-word;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Modal event listeners
        window.onclick = function(event) {
            const salaryModal = document.getElementById('salaryModal');
            const benefitModal = document.getElementById('benefitModal');
            if (event.target === salaryModal) {
                closeSalaryModal();
            }
            if (event.target === benefitModal) {
                closeBenefitModal();
            }
        }

        // Adicionar CSS para anima√ß√µes
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>
