<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyTracker - Gest√£o Financeira</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            color: #ffffff;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background: rgba(0, 255, 127, 0.1);
            border-radius: 15px;
            border: 1px solid #00ff7f;
            box-shadow: 0 0 20px rgba(0, 255, 127, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            color: #00ff7f;
            text-shadow: 0 0 10px rgba(0, 255, 127, 0.5);
            margin-bottom: 10px;
        }

        .balance-display {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .balance-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .balance-card h3 {
            color: #00ff7f;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .balance-amount {
            font-size: 1.8em;
            font-weight: bold;
        }

        .balance-amount.positive {
            color: #00ff7f;
        }

        .balance-amount.negative {
            color: #ff4757;
        }

        .tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 5px;
            border: 1px solid rgba(0, 255, 127, 0.3);
        }

        .tab {
            flex: 1;
            padding: 15px 25px;
            background: transparent;
            border: none;
            color: #ffffff;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 1em;
        }

        .tab.active {
            background: #00ff7f;
            color: #000000;
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.5);
        }

        .tab:hover:not(.active) {
            background: rgba(0, 255, 127, 0.2);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-container {
            background: rgba(255, 255, 255, 0.05);
            padding: 30px;
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            margin-bottom: 30px;
            backdrop-filter: blur(10px);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #00ff7f;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-group input, .form-group select {
            padding: 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
            font-size: 1em;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #00ff7f;
            box-shadow: 0 0 10px rgba(0, 255, 127, 0.3);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-primary {
            background: #00ff7f;
            color: #000000;
        }

        .btn-primary:hover {
            background: #00cc66;
            box-shadow: 0 0 15px rgba(0, 255, 127, 0.5);
        }

        .btn-danger {
            background: #ff4757;
            color: #ffffff;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: #ffffff;
            border: 1px solid rgba(0, 255, 127, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(0, 255, 127, 0.2);
            border-color: #00ff7f;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
        }

        .file-input-container input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .view-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .view-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 8px;
            color: #ffffff;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-btn.active {
            background: rgba(0, 255, 127, 0.2);
            border-color: #00ff7f;
        }

        .transactions-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            overflow: hidden;
        }

        .transaction-item {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr 1fr auto;
            gap: 15px;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            align-items: center;
            transition: background 0.3s ease;
        }

        .transaction-item:hover {
            background: rgba(0, 255, 127, 0.1);
        }

        .transaction-item:last-child {
            border-bottom: none;
        }

        .transaction-date {
            color: #cccccc;
            font-size: 0.9em;
        }

        .transaction-description {
            font-weight: 500;
        }

        .transaction-category {
            color: #00ff7f;
            font-size: 0.9em;
        }

        .transaction-amount {
            font-weight: bold;
            text-align: right;
        }

        .transaction-amount.income {
            color: #00ff7f;
        }

        .transaction-amount.expense {
            color: #ff4757;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            padding: 20px;
            height: 400px;
            position: relative;
        }

        .chart-canvas {
            width: 100%;
            height: 100%;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .summary-card {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
        }

        .summary-card h4 {
            color: #00ff7f;
            margin-bottom: 15px;
            font-size: 1.2em;
        }

        .summary-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .summary-item:last-child {
            border-bottom: none;
        }

        .filter-container {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
        }

        .filter-container input, .filter-container select {
            padding: 8px 12px;
            border: 1px solid rgba(0, 255, 127, 0.3);
            border-radius: 6px;
            background: rgba(0, 0, 0, 0.3);
            color: #ffffff;
        }

        @media (max-width: 768px) {
            .transaction-item {
                grid-template-columns: 1fr;
                gap: 8px;
                text-align: left;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-direction: column;
            }

            .view-controls {
                justify-content: stretch;
            }

            .view-btn {
                flex: 1;
                text-align: center;
            }
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #cccccc;
        }

        .empty-state i {
            font-size: 3em;
            color: #00ff7f;
            margin-bottom: 20px;
        }

        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 255, 127, 0.5);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 255, 127, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>MoneyTracker</h1>
            <p>Gerencie suas finan√ßas de forma inteligente</p>
        </header>

        <div class="balance-display">
            <div class="balance-card">
                <h3>Receitas Totais</h3>
                <div class="balance-amount positive" id="totalIncome">R$ 0,00</div>
            </div>
            <div class="balance-card">
                <h3>Gastos Totais</h3>
                <div class="balance-amount negative" id="totalExpenses">R$ 0,00</div>
            </div>
            <div class="balance-card">
                <h3>Saldo Atual</h3>
                <div class="balance-amount" id="currentBalance">R$ 0,00</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="showSection('income')">Adicionar Receita</button>
            <button class="tab" onclick="showSection('expense')">Adicionar Gasto</button>
            <button class="tab" onclick="showSection('dashboard')">Dashboard</button>
        </div>

        <!-- Se√ß√£o Adicionar Receita -->
        <div id="income-section" class="content-section active">
            <div class="form-container">
                <h2 style="color: #00ff7f; margin-bottom: 20px;">Adicionar Receita</h2>
                <form id="incomeForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="incomeDescription">Descri√ß√£o</label>
                            <input type="text" id="incomeDescription" placeholder="Ex: Sal√°rio, Freelance..." required>
                        </div>
                        <div class="form-group">
                            <label for="incomeAmount">Valor (R$)</label>
                            <input type="number" id="incomeAmount" step="0.01" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeDate">Data de Recebimento</label>
                            <input type="date" id="incomeDate" required>
                        </div>
                        <div class="form-group">
                            <label for="incomeCategory">Categoria</label>
                            <select id="incomeCategory" required>
                                <option value="">Selecione...</option>
                                <option value="Sal√°rio">Sal√°rio</option>
                                <option value="Freelance">Freelance</option>
                                <option value="Investimentos">Investimentos</option>
                                <option value="Vendas">Vendas</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Receita</button>
                </form>
            </div>
        </div>

        <!-- Se√ß√£o Adicionar Gasto -->
        <div id="expense-section" class="content-section">
            <div class="form-container">
                <h2 style="color: #ff4757; margin-bottom: 20px;">Adicionar Gasto</h2>
                <form id="expenseForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label for="expenseDescription">Descri√ß√£o</label>
                            <input type="text" id="expenseDescription" placeholder="Ex: Supermercado, Gasolina..." required>
                        </div>
                        <div class="form-group">
                            <label for="expenseAmount">Valor (R$)</label>
                            <input type="number" id="expenseAmount" step="0.01" placeholder="0,00" required>
                        </div>
                        <div class="form-group">
                            <label for="expenseDate">Data de Pagamento</label>
                            <input type="date" id="expenseDate" required>
                        </div>
                        <div class="form-group">
                            <label for="expenseCategory">Categoria</label>
                            <select id="expenseCategory" required>
                                <option value="">Selecione...</option>
                                <option value="Alimenta√ß√£o">Alimenta√ß√£o</option>
                                <option value="Transporte">Transporte</option>
                                <option value="Moradia">Moradia</option>
                                <option value="Sa√∫de">Sa√∫de</option>
                                <option value="Educa√ß√£o">Educa√ß√£o</option>
                                <option value="Lazer">Lazer</option>
                                <option value="Vestu√°rio">Vestu√°rio</option>
                                <option value="Outros">Outros</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">Adicionar Gasto</button>
                </form>
            </div>
        </div>

        <!-- Se√ß√£o Dashboard -->
        <div id="dashboard-section" class="content-section">
            <div class="filter-container">
                <label style="color: #00ff7f;">Filtros:</label>
                <input type="date" id="filterStartDate" placeholder="Data Inicial">
                <input type="date" id="filterEndDate" placeholder="Data Final">
                <select id="filterCategory">
                    <option value="">Todas as Categorias</option>
                </select>
                <button class="btn btn-primary" onclick="applyFilters()">Aplicar Filtros</button>
            </div>

            <div class="filter-container" style="justify-content: center; margin-top: 20px;">
                <input type="file" id="csvFileInput" accept=".csv" style="display: none;" onchange="importCSV(event)">
                <button class="btn btn-primary" onclick="document.getElementById('csvFileInput').click()">Importar CSV</button>
                <button class="btn btn-primary" onclick="exportCSV()">Exportar CSV</button>
                <button class="btn btn-danger" onclick="clearData()">Limpar Dados</button>
            </div>

            <div class="view-controls">
                <button class="view-btn active" onclick="showView('table')">Tabela</button>
                <button class="view-btn" onclick="showView('chart')">Gr√°fico Di√°rio</button>
                <button class="view-btn" onclick="showView('accumulated')">Acumulado</button>
                <button class="view-btn" onclick="showView('summary')">Resumo</button>
            </div>

            <!-- Visualiza√ß√£o Tabela -->
            <div id="table-view" class="view-content">
                <div class="transactions-container">
                    <div id="transactionsList"></div>
                </div>
            </div>

            <!-- Visualiza√ß√£o Gr√°fico Di√°rio -->
            <div id="chart-view" class="view-content" style="display: none;">
                <div class="chart-container">
                    <canvas id="financeChart" class="chart-canvas"></canvas>
                </div>
            </div>

            <!-- Visualiza√ß√£o Gr√°fico Acumulado -->
            <div id="accumulated-view" class="view-content" style="display: none;">
                <div class="chart-container">
                    <canvas id="accumulatedChart" class="chart-canvas"></canvas>
                </div>
            </div>

            <!-- Visualiza√ß√£o Resumo -->
            <div id="summary-view" class="view-content" style="display: none;">
                <div class="summary-grid">
                    <div class="summary-card">
                        <h4>Receitas por Categoria</h4>
                        <div id="incomeSummary"></div>
                    </div>
                    <div class="summary-card">
                        <h4>Gastos por Categoria</h4>
                        <div id="expenseSummary"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script>
        // Sistema de armazenamento
        let transactions = [];
        let chart = null;
        let accumulatedChart = null;

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Definir data atual como padr√£o
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('incomeDate').value = today;
            document.getElementById('expenseDate').value = today;
            
            // Carregar dados salvos (simulado)
            loadData();
            updateDisplay();
            populateCategories();

            // Event listeners
            document.getElementById('incomeForm').addEventListener('submit', addIncome);
            document.getElementById('expenseForm').addEventListener('submit', addExpense);
        });

        function showSection(section) {
            // Remover classe active de todas as tabs
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(sec => sec.classList.remove('active'));

            // Ativar tab e se√ß√£o espec√≠fica
            event.target.classList.add('active');
            document.getElementById(section + '-section').classList.add('active');

            if (section === 'dashboard') {
                updateDisplay();
                showView('table');
            }
        }

        function showView(viewType) {
            // Atualizar bot√µes de visualiza√ß√£o
            document.querySelectorAll('.view-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            // Mostrar visualiza√ß√£o espec√≠fica
            document.querySelectorAll('.view-content').forEach(view => view.style.display = 'none');
            document.getElementById(viewType + '-view').style.display = 'block';

            if (viewType === 'table') {
                displayTransactions();
            } else if (viewType === 'chart') {
                displayChart();
            } else if (viewType === 'accumulated') {
                displayAccumulatedChart();
            } else if (viewType === 'summary') {
                displaySummary();
            }
        }

        function addIncome(e) {
            e.preventDefault();
            const form = e.target;
            const transaction = {
                id: Date.now(),
                type: 'income',
                description: form.incomeDescription.value,
                amount: parseFloat(form.incomeAmount.value),
                date: form.incomeDate.value,
                category: form.incomeCategory.value
            };

            transactions.push(transaction);
            saveData(); // Salvar no localStorage
            updateDisplay();
            form.reset();
            
            // Definir data atual novamente
            form.incomeDate.value = new Date().toISOString().split('T')[0];

            showNotification('Receita adicionada e salva com sucesso!', 'success');
        }

        function addExpense(e) {
            e.preventDefault();
            const form = e.target;
            const transaction = {
                id: Date.now(),
                type: 'expense',
                description: form.expenseDescription.value,
                amount: parseFloat(form.expenseAmount.value),
                date: form.expenseDate.value,
                category: form.expenseCategory.value
            };

            transactions.push(transaction);
            saveData(); // Salvar no localStorage
            updateDisplay();
            form.reset();
            
            // Definir data atual novamente
            form.expenseDate.value = new Date().toISOString().split('T')[0];

            showNotification('Gasto adicionado e salvo com sucesso!', 'success');
        }

        function updateDisplay() {
            const income = transactions
                .filter(t => t.type === 'income')
                .reduce((sum, t) => sum + t.amount, 0);

            const expenses = transactions
                .filter(t => t.type === 'expense')
                .reduce((sum, t) => sum + t.amount, 0);

            const balance = income - expenses;

            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpenses').textContent = formatCurrency(expenses);
            
            const balanceElement = document.getElementById('currentBalance');
            balanceElement.textContent = formatCurrency(balance);
            balanceElement.className = `balance-amount ${balance >= 0 ? 'positive' : 'negative'}`;
        }

        function displayTransactions() {
            const container = document.getElementById('transactionsList');
            const filtered = getFilteredTransactions();
            
            if (filtered.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div style="font-size: 3em; color: #00ff7f;">+</div>
                        <h3>Nenhuma transa√ß√£o encontrada</h3>
                        <p>Adicione receitas e gastos para come√ßar a acompanhar suas finan√ßas</p>
                    </div>
                `;
                return;
            }

            // Ordenar por data (mais recente primeiro)
            const sortedTransactions = [...filtered].sort((a, b) => new Date(b.date) - new Date(a.date));

            container.innerHTML = sortedTransactions.map(transaction => `
                <div class="transaction-item">
                    <div class="transaction-date">${formatDate(transaction.date)}</div>
                    <div class="transaction-description">${transaction.description}</div>
                    <div class="transaction-category">${transaction.category}</div>
                    <div class="transaction-amount ${transaction.type}">
                        ${transaction.type === 'income' ? '+' : '-'} ${formatCurrency(transaction.amount)}
                    </div>
                    <button class="btn btn-danger" onclick="deleteTransaction(${transaction.id})" style="padding: 5px 10px; font-size: 0.8em;">Excluir</button>
                </div>
            `).join('');
        }

        function displayChart() {
            const ctx = document.getElementById('financeChart').getContext('2d');
            
            if (chart) {
                chart.destroy();
            }

            const filtered = getFilteredTransactions();

            // Agrupar transa√ß√µes por data
            const dailyData = {};
            filtered.forEach(transaction => {
                const date = transaction.date;
                if (!dailyData[date]) {
                    dailyData[date] = { income: 0, expense: 0 };
                }
                if (transaction.type === 'income') {
                    dailyData[date].income += transaction.amount;
                } else {
                    dailyData[date].expense += transaction.amount;
                }
            });

            const dates = Object.keys(dailyData).sort();
            const incomeData = dates.map(date => dailyData[date].income);
            const expenseData = dates.map(date => dailyData[date].expense);

            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates.map(date => formatDate(date)),
                    datasets: [{
                        label: 'Receitas Di√°rias',
                        data: incomeData,
                        borderColor: '#00ff7f',
                        backgroundColor: 'rgba(0, 255, 127, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }, {
                        label: 'Gastos Di√°rios',
                        data: expenseData,
                        borderColor: '#ff4757',
                        backgroundColor: 'rgba(255, 71, 87, 0.1)',
                        borderWidth: 3,
                        fill: false,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Fluxo Financeiro Di√°rio',
                            color: '#00ff7f',
                            font: { size: 16 }
                        },
                        legend: {
                            labels: {
                                color: '#ffffff'
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function displayAccumulatedChart() {
            const ctx = document.getElementById('accumulatedChart').getContext('2d');
            
            if (accumulatedChart) {
                accumulatedChart.destroy();
            }

            const filtered = getFilteredTransactions();

            if (filtered.length === 0) {
                ctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);
                ctx.fillStyle = '#cccccc';
                ctx.font = '16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Nenhum dado para exibir', ctx.canvas.width / 2, ctx.canvas.height / 2);
                return;
            }

            // Agrupar e calcular saldo acumulado por data
            const dailyData = {};
            filtered.forEach(transaction => {
                const date = transaction.date;
                if (!dailyData[date]) {
                    dailyData[date] = { income: 0, expense: 0 };
                }
                if (transaction.type === 'income') {
                    dailyData[date].income += transaction.amount;
                } else {
                    dailyData[date].expense += transaction.amount;
                }
            });

            // Ordenar datas e calcular acumulados
            const sortedDates = Object.keys(dailyData).sort();
            let runningIncome = 0;
            let runningExpense = 0;
            let runningBalance = 0;
            
            const accumulatedData = sortedDates.map(date => {
                runningIncome += dailyData[date].income;
                runningExpense += dailyData[date].expense;
                runningBalance = runningIncome - runningExpense;
                
                return {
                    date: date,
                    accumulatedIncome: runningIncome,
                    accumulatedExpense: runningExpense,
                    balance: runningBalance,
                    dailyIncome: dailyData[date].income,
                    dailyExpense: dailyData[date].expense
                };
            });

            const labels = accumulatedData.map(item => formatDate(item.date));
            const incomeData = accumulatedData.map(item => item.accumulatedIncome);
            const expenseData = accumulatedData.map(item => item.accumulatedExpense);
            const balanceData = accumulatedData.map(item => item.balance);

            accumulatedChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Receitas Acumuladas',
                        data: incomeData,
                        borderColor: '#00ff7f',
                        backgroundColor: 'rgba(0, 255, 127, 0.1)',
                        borderWidth: 3,
                        fill: '+1',
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#00ff7f',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }, {
                        label: 'Gastos Acumulados',
                        data: expenseData,
                        borderColor: '#ff4757',
                        backgroundColor: 'rgba(255, 71, 87, 0.1)',
                        borderWidth: 3,
                        fill: 'origin',
                        tension: 0.4,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#ff4757',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2
                    }, {
                        label: 'Saldo L√≠quido',
                        data: balanceData,
                        borderColor: '#ffa500',
                        backgroundColor: 'rgba(255, 165, 0, 0.1)',
                        borderWidth: 4,
                        fill: false,
                        tension: 0.4,
                        pointRadius: 6,
                        pointHoverRadius: 8,
                        pointBackgroundColor: '#ffa500',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        borderDash: [5, 5]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Evolu√ß√£o Patrimonial - Valores Acumulados',
                            color: '#00ff7f',
                            font: { size: 18, weight: 'bold' }
                        },
                        legend: {
                            labels: {
                                color: '#ffffff',
                                usePointStyle: true,
                                padding: 20
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const datasetLabel = context.dataset.label;
                                    const value = context.parsed.y;
                                    return `${datasetLabel}: ${formatCurrency(value)}`;
                                },
                                afterLabel: function(context) {
                                    const dataIndex = context.dataIndex;
                                    const dailyData = accumulatedData[dataIndex];
                                    if (context.datasetIndex === 2) { // Saldo L√≠quido
                                        return [
                                            `--- Movimento do Dia ---`,
                                            `Receita: ${formatCurrency(dailyData.dailyIncome)}`,
                                            `Gasto: ${formatCurrency(dailyData.dailyExpense)}`,
                                            `Resultado: ${formatCurrency(dailyData.dailyIncome - dailyData.dailyExpense)}`
                                        ];
                                    }
                                    return null;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: '#ffffff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            ticks: {
                                color: '#ffffff',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    interaction: {
                        intersect: false,
                        mode: 'index'
                    }
                }
            });
        }

        function displaySummary() {
            // Resumo de receitas por categoria
            const incomeByCategory = {};
            const expenseByCategory = {};

            transactions.forEach(transaction => {
                if (transaction.type === 'income') {
                    incomeByCategory[transaction.category] = (incomeByCategory[transaction.category] || 0) + transaction.amount;
                } else {
                    expenseByCategory[transaction.category] = (expenseByCategory[transaction.category] || 0) + transaction.amount;
                }
            });

            // Exibir receitas por categoria
            const incomeSummary = document.getElementById('incomeSummary');
            if (Object.keys(incomeByCategory).length === 0) {
                incomeSummary.innerHTML = '<p style="color: #cccccc;">Nenhuma receita registrada</p>';
            } else {
                incomeSummary.innerHTML = Object.entries(incomeByCategory)
                    .sort((a, b) => b[1] - a[1])
                    .map(([category, amount]) => `
                        <div class="summary-item">
                            <span>${category}</span>
                            <span style="color: #00ff7f;">${formatCurrency(amount)}</span>
                        </div>
                    `).join('');
            }

            // Exibir gastos por categoria
            const expenseSummary = document.getElementById('expenseSummary');
            if (Object.keys(expenseByCategory).length === 0) {
                expenseSummary.innerHTML = '<p style="color: #cccccc;">Nenhum gasto registrado</p>';
            } else {
                expenseSummary.innerHTML = Object.entries(expenseByCategory)
                    .sort((a, b) => b[1] - a[1])
                    .map(([category, amount]) => `
                        <div class="summary-item">
                            <span>${category}</span>
                            <span style="color: #ff4757;">${formatCurrency(amount)}</span>
                        </div>
                    `).join('');
            }
        }

        function deleteTransaction(id) {
            if (confirm('Tem certeza que deseja excluir esta transa√ß√£o?')) {
                transactions = transactions.filter(t => t.id !== id);
                saveData(); // Salvar altera√ß√£o no localStorage
                updateDisplay();
                displayTransactions();
                showNotification('Transa√ß√£o exclu√≠da e salva com sucesso!', 'success');
            }
        }

        function populateCategories() {
            const incomeCategories = ['Sal√°rio', 'Freelance', 'Investimentos', 'Vendas', 'Outros'];
            const expenseCategories = ['Alimenta√ß√£o', 'Transporte', 'Moradia', 'Sa√∫de', 'Educa√ß√£o', 'Lazer', 'Vestu√°rio', 'Outros'];
            
            const filterCategory = document.getElementById('filterCategory');
            filterCategory.innerHTML = '<option value="">Todas as Categorias</option>';
            
            [...new Set([...incomeCategories, ...expenseCategories])].forEach(category => {
                filterCategory.innerHTML += `<option value="${category}">${category}</option>`;
            });
        }

        function applyFilters() {
            // Esta fun√ß√£o pode ser expandida para filtrar as transa√ß√µes
            displayTransactions();
            showNotification('Filtros aplicados!', 'info');
        }

        function getFilteredTransactions() {
            let filtered = [...transactions];
            
            const startDate = document.getElementById('filterStartDate').value;
            const endDate = document.getElementById('filterEndDate').value;
            const category = document.getElementById('filterCategory').value;

            if (startDate) {
                filtered = filtered.filter(t => t.date >= startDate);
            }

            if (endDate) {
                filtered = filtered.filter(t => t.date <= endDate);
            }

            if (category) {
                filtered = filtered.filter(t => t.category === category);
            }

            return filtered;
        }

        function clearData() {
            if (confirm('Tem certeza que deseja limpar todos os dados? Esta a√ß√£o n√£o pode ser desfeita.')) {
                transactions = [];
                saveData(); // Limpar tamb√©m do localStorage
                updateDisplay();
                displayTransactions();
                if (chart) chart.destroy();
                
                // Limpar tamb√©m os filtros
                document.getElementById('filterStartDate').value = '';
                document.getElementById('filterEndDate').value = '';
                document.getElementById('filterCategory').value = '';
                
                showNotification('Todos os dados foram limpos permanentemente!', 'info');
            }
        }

        function exportCSV() {
            if (transactions.length === 0) {
                showNotification('Nenhuma transa√ß√£o para exportar!', 'error');
                return;
            }

            // Criar cabe√ßalho CSV
            const headers = ['Data', 'Tipo', 'Descri√ß√£o', 'Categoria', 'Valor'];
            
            // Converter transa√ß√µes para CSV
            const csvData = transactions.map(transaction => [
                transaction.date,
                transaction.type === 'income' ? 'Receita' : 'Gasto',
                `"${transaction.description}"`, // Aspas para proteger v√≠rgulas na descri√ß√£o
                transaction.category,
                transaction.amount.toFixed(2)
            ]);

            // Combinar cabe√ßalho e dados
            const csvContent = [headers, ...csvData]
                .map(row => row.join(','))
                .join('\n');

            // Criar e baixar arquivo
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const today = new Date().toISOString().split('T')[0];
            link.setAttribute('href', url);
            link.setAttribute('download', `financas_${today}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);

            showNotification('Dados exportados com sucesso!', 'success');
        }

        function importCSV(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.type !== 'text/csv' && !file.name.endsWith('.csv')) {
                showNotification('Por favor, selecione um arquivo CSV v√°lido!', 'error');
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const csvText = e.target.result;
                    const lines = csvText.split('\n').filter(line => line.trim());
                    
                    if (lines.length < 2) {
                        showNotification('Arquivo CSV vazio ou inv√°lido!', 'error');
                        return;
                    }

                    // Pular cabe√ßalho (primeira linha)
                    const dataLines = lines.slice(1);
                    let importCount = 0;
                    let errorCount = 0;

                    dataLines.forEach((line, index) => {
                        try {
                            // Parse da linha CSV (considerando aspas na descri√ß√£o)
                            const values = parseCSVLine(line);
                            
                            if (values.length >= 5) {
                                const [date, type, description, category, amount] = values;
                                
                                // Validar dados
                                if (date && (type === 'Receita' || type === 'Gasto') && description && category && !isNaN(parseFloat(amount))) {
                                    const transaction = {
                                        id: Date.now() + index, // ID √∫nico
                                        type: type === 'Receita' ? 'income' : 'expense',
                                        description: description.replace(/^"|"$/g, ''), // Remover aspas
                                        amount: parseFloat(amount),
                                        date: date,
                                        category: category
                                    };
                                    
                                    transactions.push(transaction);
                                    importCount++;
                                } else {
                                    errorCount++;
                                }
                            } else {
                                errorCount++;
                            }
                        } catch (error) {
                            errorCount++;
                        }
                    });

                    saveData(); // Salvar dados importados no localStorage
                    updateDisplay();
                    displayTransactions();
                    
                    if (importCount > 0) {
                        showNotification(`${importCount} transa√ß√µes importadas e salvas com sucesso! ${errorCount > 0 ? `(${errorCount} linhas com erro)` : ''}`, 'success');
                    } else {
                        showNotification('Nenhuma transa√ß√£o v√°lida encontrada no arquivo!', 'error');
                    }

                } catch (error) {
                    showNotification('Erro ao processar arquivo CSV!', 'error');
                    console.error('Erro na importa√ß√£o:', error);
                }

                // Limpar input
                event.target.value = '';
            };

            reader.readAsText(file);
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        function saveData() {
            try {
                localStorage.setItem('moneyTrackerTransactions', JSON.stringify(transactions));
            } catch (error) {
                console.warn('N√£o foi poss√≠vel salvar no localStorage:', error);
                // Fallback: continuar funcionando apenas na mem√≥ria
            }
        }

        function loadData() {
            try {
                const saved = localStorage.getItem('moneyTrackerTransactions');
                if (saved) {
                    transactions = JSON.parse(saved);
                    return;
                }
            } catch (error) {
                console.warn('N√£o foi poss√≠vel carregar do localStorage:', error);
            }
            
            // Se n√£o h√° dados salvos ou houve erro, inicializar com dados de exemplo
            if (transactions.length === 0) {
                const today = new Date();
                const yesterday = new Date(today);
                yesterday.setDate(yesterday.getDate() - 1);
                
                transactions = [
                    
                ];
                saveData(); 
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(amount);
        }

        function formatDate(dateString) {
            return new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR');
        }

        function showNotification(message, type) {
            // Criar elemento de notifica√ß√£o
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? 'rgba(0, 255, 127, 0.9)' : 
                             type === 'error' ? 'rgba(255, 71, 87, 0.9)' : 
                             'rgba(0, 150, 255, 0.9)'};
                color: ${type === 'success' ? '#000' : '#fff'};
                padding: 15px 20px;
                border-radius: 8px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
                z-index: 1000;
                animation: slideIn 0.3s ease;
                max-width: 300px;
                word-wrap: break-word;
            `;
            notification.textContent = message;

            document.body.appendChild(notification);

            // Remover ap√≥s 3 segundos
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => notification.remove(), 300);
            }, 3000);
        }

        // Adicionar CSS para anima√ß√µes de notifica√ß√£o
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>